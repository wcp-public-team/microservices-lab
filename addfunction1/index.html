


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Add logic to your application - Microservices Lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#add-logic-to-your-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Microservices Lab" class="md-header-nav__button md-logo" aria-label="Microservices Lab">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Microservices Lab
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Add logic to your application
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Microservices Lab" class="md-nav__button md-logo" aria-label="Microservices Lab">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Microservices Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../signup/" title="Sign up for IBM Cloud" class="md-nav__link">
      Sign up for IBM Cloud
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../explore/" title="Explore IBM Cloud" class="md-nav__link">
      Explore IBM Cloud
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../createapp/" title="Create your first application" class="md-nav__link">
      Create your first application
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Add logic to your application" class="md-nav__link md-nav__link--active">
      Add logic to your application
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../addfunction2/" title="Add another function" class="md-nav__link">
      Add another function
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apiexplorer/" title="Using the API Explorer" class="md-nav__link">
      Using the API Explorer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../summary/" title="Summary" class="md-nav__link">
      Summary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../resources/" title="Additional Learning Resources" class="md-nav__link">
      Additional Learning Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="add-logic-to-your-application">Add logic to your application</h1>
<p>At this point in the lab you have created your IBM Cloud account, created your first application and deployed it.  You have seen the toolchain that was created for your application and verified that it is up and running.  Now it is time to add the logic for your microservice.  In this section you will create a new function to return a list of customers.</p>
<p>Click the hamburger menu, then click on <code>DevOps</code> on the navigation menu that pops up.</p>
<p><img alt="hamburger menu" src="../images/HamburgerMenuButton.png" /></p>
<p><img alt="Devops" src="../images/HamburgerDevOps.png" /></p>
<p>This is where you will find all of your application toolchains.  Click on the name of your toolchain to view it.</p>
<p>Click on the <code>Eclipse Orion Web IDE</code> tile.</p>
<p>This is a full feature editing environment that runs in your browser.  When it first loads it clones the git repo much like you would if you were editing code locally.  Starting now you will be working on a "local" copy of your repo, although you don't have to worry about having any git-related tools on your laptop.</p>
<p>The code that you see is the default code that got initially loaded when you created the application.  It is a fully functional application that you can extend with your own code.  For the purposes of this lab you are not expected to know anything about node.js or the code in this application.  The code you need to add and instructions for where to add it will be provided in the lab instructions.</p>
<p>When you first enter the web editor the page you see should look like this:</p>
<p><img alt="Web editor" src="../images/OrionLandingPage.png" /></p>
<p>On the left navigation menu right-click on the <code>server</code> folder and choose <code>New -&gt; File</code>.  Name the file <code>customer.js</code>.  This file will contain logic that will return a list of three customers.  In a real application this function would retrieve the customers from a database, such as the Cloudant database you added to your application when you created it.  For the purposes of this lab you will just return a hard-coded list of customers.</p>
<p>Copy and paste the code below into the file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>The Orion Web IDE will automatically save your changes for you.  If for some reason it hasn't saved them and you try to open a differnt file it will warn you that you have unsaved changes.  If this happens you can use the File -&gt; Save menu to manually save your changes.</em></p>
</div>
<pre><code>exports.getCustomers = function(req, res) {

    var customers = [
        {
            id: &quot;12345&quot;,
            name: &quot;Dave Wakeman&quot;,
            plan: &quot;Gold&quot;
        },
        {
            id: &quot;12367&quot;,
            name: &quot;Eddie Wilson&quot;,
            plan: &quot;Platinum&quot;
        },
        {
            id: &quot;12389&quot;,
            name: &quot;Anna McFaul&quot;,
            plan: &quot;Silver&quot;
        }
    ]

    res.json(customers);

}
</code></pre>

<p>Right click the <code>routers</code> directory under the <code>server</code> directory and create a new file named <code>myservice.js</code>.  The code below creates a <code>route</code> for your api and links it to the function you created in <code>customer.js</code>.  The new route will be <code>http://&lt;your-app-name&gt;.mybluemix.net/customers</code>.</p>
<p>Copy and paste the following code into the file.</p>
<pre><code>var customer = require('../customer');

module.exports = function(app){

    app.get(&quot;/customers&quot;, customer.getCustomers);

}
</code></pre>

<p>Click on the file named <code>server.js</code> in the <code>server</code> directory.  Copy and paste the line of code below on line 24 after this line of code:</p>
<p><code>23  // add your code here</code></p>
<pre><code>// Add your code here
require('./routers/myservice')(app);
</code></pre>

<p>Now you have added some code into your microservice and are ready to deploy it.  Remember that you've been working with a local clone of your git repo, so you first need to commit the code in the local git repo.</p>
<p>Click on the icon that looks like a road sign in the left navigation bar:</p>
<p><img alt="Link to Git page in Orion left nav" src="../images/OrionLeftNavGit.png" /></p>
<p>You can see some files selected in the <code>Working Directory Changes</code> pane.  These are the files that you updated.  To commit these changes in the local repo add a comment into the text area and click the blue <code>Commmit</code> button.</p>
<p><img alt="Git page in web editor" src="../images/OrionCommitChanges.png" /></p>
<p>Once you have committed these changes you will see that there are some changes listed in the Outgoing section.  This is because you have committed these changes to the local repo and they are ready to be "pushed" to the remote repo, which is the repo in IBM Cloud.  </p>
<p>Click the <code>Push</code> button to push your changes.</p>
<p><img alt="Push changes" src="../images/OrionPushChanges.png" /></p>
<p>When the push is complete you will see that there are no more outgoing changes, and you should see a new line in the history that shows your commit being pushed.</p>
<p><img alt="after push" src="../images/OrionAfterPush.png" /></p>
<p>So now what?  If you remember when the toolchain for your application was built it included a build stage.  That build stage is triggered to fire whenever changes get committed to the git repo in IBM Cloud.  That happened when you pushed your changes in the previous step, so your toolchain's build stage just fired!</p>
<p>CLick on the back arrow icon on the left navigation toolbar to go back to your toolchain.</p>
<p><img alt="Back to toolchain" src="../images/OrionLeftNavBack.png" /></p>
<p>Click on the Delivery Pipeline tile.</p>
<p>You should see that your Build stage has run again and your Deploy stage is probably still running.</p>
<p><img alt="Delivery Pipeline" src="../images/AfterPushDeliveryPipeline.png" /></p>
<p>When it finishes your changes are deployed!</p>
<p><img alt="Deploy stage finished" src="../images/AfterPushDeployStageFinished.png" /></p>
<p>Click on the URL for your app in the Last Execution Result box of the Deploy Stage.  We still don't have a default route defined so the browser will show <code>Not found</code>.  This is still okay.  The URL for our new route is:</p>
<p><code>http://&lt;your-app-route&gt;.mybluemix.net/customers</code></p>
<p>Therefore you need to add <code>/customers</code> to the end of your URL and hit enter.</p>
<p><img alt="" src="../images/GetCustomersResult.png" /></p>
<p>You just executed the new code and returned a list of customers!  Your microservice now has a function that returns a list of customers.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../createapp/" title="Create your first application" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Create your first application
              </div>
            </div>
          </a>
        
        
          <a href="../addfunction2/" title="Add another function" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Add another function
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>